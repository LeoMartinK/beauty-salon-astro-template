---
// src/components/atoms/StatusBanner.astro
import { siteData } from 'src/data/siteData';

const { status } = siteData;

// Si no est√° activo o es default, no mostrar nada
if (!status.active || status.id === 'default') return null;

// DETECTAR TIPOS
const isCelebration = status.type === 'celebration';
const isVacation = status.type === 'vacation';

// --- CONFIGURACI√ìN DE ESTILOS ---

let containerClasses = '';
let textClasses = '';
let titleClasses = '';
let iconContainer = '';

if (isCelebration) {
  containerClasses = `
    bg-gradient-to-br from-yellow-300 via-amber-400 to-yellow-500
    border-2 border-white/80
    shadow-[0_0_40px_rgba(251,191,36,0.6)]
    scale-105
  `;
  textClasses = 'text-amber-950 font-semibold';
  titleClasses = 'text-amber-900 drop-shadow-sm';
  iconContainer = 'text-4xl animate-bounce-slow filter drop-shadow-md';
} else if (isVacation) {
  containerClasses = 'bg-teal-700 border-teal-500 shadow-xl';
  textClasses = 'text-teal-50';
  titleClasses = 'text-white';
  iconContainer = 'text-2xl';
} else {
  containerClasses = 'bg-rose-600 border-rose-400 shadow-xl';
  textClasses = 'text-rose-50';
  titleClasses = 'text-white';
  iconContainer = 'text-2xl';
}

// ICONOS INTELIGENTES
let icon = '‚ö†Ô∏è';
if (isCelebration) icon = 'üéÑ';
if (isVacation) icon = '‚úàÔ∏è';

if (status.message.toLowerCase().includes('regalo')) icon = 'üéÅ';
if (status.message.toLowerCase().includes('brindamos')) icon = 'ü•Ç';
if (status.message.toLowerCase().includes('2026')) icon = 'ü•Ç';
if (status.message.toLowerCase().includes('brilles')) icon = '‚ú®';

const layoutClasses = isCelebration
  ? 'p-6 w-[90%] md:w-[500px] flex-col text-center gap-3'
  : 'p-4 w-auto max-w-md flex-row text-left gap-4';
---

<div
  id="status-banner-root"
  class="pointer-events-none fixed inset-x-0 bottom-8 z-50 flex justify-center px-4 transition-opacity duration-300"
>
  <div
    class={`
    ${containerClasses}
    ${layoutClasses}
    pointer-events-auto
    relative
    rounded-2xl
    flex items-center
    transform transition-all duration-500 hover:scale-[1.03]
    animate-pop-in
  `}
  >
    <div class={`${iconContainer} ${isCelebration ? 'mb-1' : 'bg-white/20 rounded-full p-2'}`}>
      {icon}
    </div>

    <div class="flex flex-col">
      {
        isCelebration && (
          <span class={`font-serif text-2xl font-bold uppercase tracking-wider ${titleClasses}`}>
            ¬°Felices Fiestas!
          </span>
        )
      }

      <p class={`text-sm md:text-base leading-snug ${textClasses}`}>
        {status.message}
      </p>
    </div>

    <button
      id="close-banner-btn"
      class="absolute -right-3 -top-3 cursor-pointer rounded-full border border-gray-200 bg-white p-1.5 text-gray-500 shadow-md transition-all hover:scale-110 hover:text-red-500"
      aria-label="Cerrar aviso"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        ><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg
      >
    </button>
  </div>
</div>

<style>
  @keyframes popIn {
    0% {
      opacity: 0;
      transform: scale(0.5) translateY(50px);
    }
    70% {
      transform: scale(1.05);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }
  .animate-pop-in {
    animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }

  @keyframes bounceSlow {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-5px);
    }
  }
  .animate-bounce-slow {
    animation: bounceSlow 2s infinite ease-in-out;
  }
</style>

<script>
  // ‚úÖ L√ìGICA DE MEMORIA (SessionStorage)
  document.addEventListener('astro:page-load', () => {
    const banner = document.getElementById('status-banner-root');
    const closeBtn = document.getElementById('close-banner-btn');

    // 1. Verificamos si ya lo cerraron antes
    if (sessionStorage.getItem('banner-closed') === 'true') {
      banner?.remove(); // Si ya lo cerr√≥, lo quitamos inmediatamente
      return;
    }

    // 2. Evento al hacer clic en cerrar
    closeBtn?.addEventListener('click', () => {
      // Animaci√≥n de salida opcional
      banner?.style.setProperty('opacity', '0');

      setTimeout(() => {
        banner?.remove();
        // Guardamos en memoria que el usuario ya lo cerr√≥
        sessionStorage.setItem('banner-closed', 'true');
      }, 300);
    });
  });
</script>
