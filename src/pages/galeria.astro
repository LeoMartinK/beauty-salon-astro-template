---
// src/pages/galeria.astro
import Button from '../components/atoms/Button.astro';
import Heading from '../components/atoms/Heading.astro';
import { siteData } from '../data/siteData';
import Layout from '../layouts/Layout.astro';

// Extraemos el usuario de la URL de Instagram automáticamente
const igHandle = siteData.social.instagram.split('/').pop() || 'peluqueriayaneth';

// Lista de fotos
const galleryItems = [
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765574728/IMG_20250118_175010924_ax9vmj.jpg',
    alt: 'Peinado recogido lateral con trenza y ondas',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765574813/IMG_20250118_172043919_bgeiui.jpg',
    alt: 'Peinado recogido con bucles definidos glam',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765574910/IMG_20240803_180739124_st4t8z.jpg',
    alt: 'Moño alto con trenzas pegadas definidas',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575027/IMG_20240503_093251019_xwnhrs.jpg',
    alt: 'Corte masculino desvanecido lateral con textura',
    category: 'Corte',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575101/IMG_20231216_174131857_rleido.jpg',
    alt: 'Recogido alto con trenza y accesorios blancos',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575158/IMG_20230804_103535664_wk40ri.jpg',
    alt: 'Coloración fucsia intensa en melena lisa media',
    category: 'Coloración',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575269/IMG_20230802_113227977_olcu47.jpg',
    alt: 'Rulos definidos en melena corta natural',
    category: 'Tratamientos',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575394/IMG_20230729_203853905_m8y0uz.jpg',
    alt: 'Trenzas cosidas en corona con trenza larga',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575499/IMG_20230729_173615627_HDR_bfymzg.jpg',
    alt: 'Alisado con keratina en cabello extra largo',
    category: 'Tratamientos',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575780/IMG_20221223_201418974_HDR_z2epcr.jpg',
    alt: 'Peinado semirecogido con bucles definidos largos',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575862/IMG_20221203_163223520_HDR_ml2m4g.jpg',
    alt: 'Peinado semirecogido con trenzas finas en V',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765575930/IMG_20220618_105441663_kwpj3u.jpg',
    alt: 'Alisado con keratina en melena larga brillante',
    category: 'Tratamientos',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765576254/IMG_20220227_180057542_kyswlc.jpg',
    alt: 'Semirecogido con bucles marcados en cabello largo',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765576626/IMG_20220219_164913996_jsyxlc.jpg',
    alt: 'Moño alto con trenza lateral envolvente',
    category: 'Peinados',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765576757/IMG_20220108_183732242_jybdoy.jpg',
    alt: 'Coloración rojo intenso en bajo de melena oscura',
    category: 'Coloración',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765576922/IMG_20211026_202941457_zb6kl5.jpg',
    alt: 'Corte pixie largo con undercut y color plata',
    category: 'Coloración',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765577006/IMG_20211019_184226473_o5g8yg.jpg',
    alt: 'Corte en capas texturizadas en melena media',
    category: 'Corte',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765577104/IMG_20210828_171454811_gwpjl1.jpg',
    alt: 'Corte degradado bajo con volumen en la cima',
    category: 'Corte',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765577225/IMG_20210705_183028657_gxla8w.jpg',
    alt: 'Corte Bob corto con volumen y movimiento',
    category: 'Corte',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765577317/IMG_20201219_102107459_yuzc0v.jpg',
    alt: 'Mechas rubias finas en cabello largo castaño',
    category: 'Coloración',
  },
  {
    src: 'https://res.cloudinary.com/dwl6lyuog/image/upload/v1765577408/IMG_20200925_175846393_ycwj0e.jpg',
    alt: 'Coloración rubio beige perlado en melena media',
    category: 'Coloración',
  },
];
---

<Layout title="Galería de Estilos | Beauty Salon Template">
  <header class="bg-pink-50 px-4 py-20 text-center">
    <Heading tagName="h1" size="xl" align="center" className="mb-4">
      Nuestro <span class="italic text-pink-500">Portfolio</span>
    </Heading>
    <p class="mx-auto max-w-2xl text-lg text-glam-gray">
      Una selección de nuestros trabajos favoritos. Inspiración real para tu próximo cambio de look.
    </p>
  </header>

  <section class="container mx-auto px-4 py-16">
    <div class="columns-2 gap-3 space-y-3 md:columns-2 md:gap-6 md:space-y-6 lg:columns-3">
      {
        galleryItems.map((item, index) => (
          <div
            class="js-scroll-reveal group relative translate-y-12 break-inside-avoid overflow-hidden rounded-xl opacity-0 shadow-md transition-all duration-1000 ease-out hover:shadow-xl md:rounded-2xl"
            style={`transition-delay: ${(index % 3) * 100}ms`}
          >
            <img
              src={item.src.replace('/upload/', '/upload/f_auto,q_auto,w_800/')}
              alt={item.alt}
              class="h-auto w-full transform object-cover transition-transform duration-700 group-hover:scale-105"
              loading="lazy"
              decoding="async"
            />
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-glam-navy/80 p-2 text-center opacity-0 transition-opacity duration-300 group-hover:opacity-100 md:p-4">
              <span class="mb-1 text-[10px] font-bold uppercase tracking-widest text-pink-300 md:mb-2 md:text-xs">
                {item.category}
              </span>
              <h3 class="font-serif text-sm text-white md:text-2xl">{item.alt}</h3>
            </div>
          </div>
        ))
      }
    </div>

    <div
      class="js-scroll-reveal mt-20 translate-y-8 rounded-3xl border border-pink-200 bg-gradient-to-r from-pink-100 to-white p-8 text-center opacity-0 transition-all duration-1000 md:p-12"
    >
      <div class="flex flex-col items-center gap-6">
        <div class="rounded-full bg-white p-4 shadow-sm">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="40"
            height="40"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-pink-500"
            ><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path
              d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line
              x1="17.5"
              y1="6.5"
              x2="17.51"
              y2="6.5"></line></svg
          >
        </div>

        <div>
          <Heading tagName="h2" size="lg" align="center" color="navy" className="mb-2">
            Síguenos en Instagram
          </Heading>
          <p class="text-lg font-medium text-glam-gray">
            @{igHandle}
          </p>
        </div>

        <Button
          href={siteData.social.instagram}
          variant="secondary"
          className="shadow-lg shadow-pink-200/50"
        >
          Ver más trabajos diarios
        </Button>

        <a
          href={siteData.social.facebook}
          class="text-sm text-glam-gray underline decoration-dotted hover:text-pink-500"
        >
          O visítanos en Facebook
        </a>
      </div>
    </div>
  </section>
</Layout>

<script>
  // ✅ CORRECCIÓN: Envolvemos todo en 'astro:page-load'
  document.addEventListener('astro:page-load', () => {
    // Configuración del Observador (El ojo que vigila el scroll)
    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1, // Se activa cuando se ve el 10% del elemento
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          // Cuando entra en pantalla, quitamos la clase invisible y la de posición
          entry.target.classList.remove('opacity-0', 'translate-y-12', 'translate-y-8');
          // Dejamos de vigilar este elemento para ahorrar memoria
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Seleccionamos todo lo que tenga la clase 'js-scroll-reveal'
    const hiddenElements = document.querySelectorAll('.js-scroll-reveal');
    hiddenElements.forEach((el) => observer.observe(el));
  });
</script>
