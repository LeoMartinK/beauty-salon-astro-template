---
// src/pages/r/[slug].astro
import { catalogsBank } from '../../data/catalogs';

export async function getStaticPaths() {
  // --- 1. DEFINIMOS LA FUNCIÓN ADENTRO PARA EVITAR ERRORES ---
  const slugify = (...args: (string | number | undefined)[]) => {
    return args
      .filter((arg) => arg !== undefined)
      .join(' ')
      .toLowerCase()
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '')
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-+|-+$/g, '');
  };

  const paths: { params: { slug: string }; props: { url: string } }[] = [];

  catalogsBank.forEach((brand) => {
    brand.campaigns.forEach((campaign) => {
      if (campaign.active) {
        campaign.items.forEach((item) => {
          let parts = [brand.brand, brand.periodType, campaign.periodValue];

          if (
            item.label &&
            !item.label.includes('Ver Revista') &&
            !item.label.includes('Catálogo')
          ) {
            parts.push(item.label);
          }

          // eslint-disable-next-line @typescript-eslint/no-explicit-any
          const slug = (item as any).slug || slugify(...parts);

          paths.push({
            params: { slug },
            props: { url: item.url },
          });
        });
      }
    });
  });

  return paths;
}

interface Props {
  url: string;
}

const { url } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Redireccionando...</title>
    <meta name="robots" content="noindex" />

    <meta http-equiv="refresh" content={`0;url=${url}`} />

    <script define:vars={{ url }} is:inline>
      window.location.href = url;
    </script>
  </head>
  <body
    style="background-color: #fcf4ec; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; color: #555;"
  >
    <div style="text-align: center;">
      <p>Te estamos llevando al catálogo...</p>
      <p style="font-size: 0.8rem;">Si no redirige, <a href={url}>haz clic aquí</a>.</p>
    </div>
  </body>
</html>
