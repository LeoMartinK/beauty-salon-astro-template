---
// src/components/organisms/FeaturedCatalogs.astro
import { catalogsBank } from '../../data/catalogs';
import Button from '../atoms/Button.astro';
import Heading from '../atoms/Heading.astro';

// 1. Filtrar solo las campañas activas
const activeCatalogs = catalogsBank
  .map((brand) => {
    const activeCampaign = brand.campaigns.find((c) => c.active);
    return {
      ...brand,
      currentCampaign: activeCampaign,
    };
  })
  .filter((item) => item.currentCampaign !== undefined)
  .slice(0, 4);
---

<section class="container mx-auto px-4 py-16 md:py-24">
  <div class="mb-12 text-center">
    <Heading tagName="h2" size="lg" align="center" className="mb-4">
      Nuestros <span class="italic text-pink-500">Catálogos</span>
    </Heading>
    <p class="mx-auto max-w-2xl text-lg text-glam-gray">
      Descubrí las últimas novedades y ofertas de tus marcas favoritas. Hacé tu pedido por WhatsApp.
    </p>
  </div>

  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
    {
      activeCatalogs.map((item) => (
        <a
          href="/links"
          class={`group relative flex flex-col items-center justify-between overflow-hidden rounded-3xl border-2 border-transparent bg-white p-6 shadow-sm transition-all duration-300 hover:-translate-y-2 hover:shadow-xl ${item.color || 'hover:border-pink-300'}`}
        >
          {/* Fondo decorativo sutil al hacer hover */}
          <div class="absolute inset-0 bg-gradient-to-br from-white to-gray-50 opacity-0 transition-opacity duration-300 group-hover:opacity-100" />

          {/* Badge de Vigencia */}
          <div class="relative z-10 mb-6 w-full text-center">
            <span
              class={`inline-block rounded-full px-3 py-1 text-[10px] font-bold uppercase tracking-widest ${item.bgBadge || 'bg-gray-100 text-gray-600'}`}
            >
              {item.periodType} {item.currentCampaign?.periodValue}
            </span>
          </div>

          {/* Logo con Fondo Dinámico (CORREGIDO) */}
          {/* Aplicamos item.logoBg si existe, o un borde gris suave por defecto si es blanco */}
          <div
            class={`relative z-10 mb-6 flex h-24 w-24 items-center justify-center rounded-2xl p-2 shadow-sm transition-transform duration-300 group-hover:scale-105 ${item.logoBg || 'border border-gray-100 bg-white'}`}
          >
            <img
              src={item.icon}
              alt={`Catálogo ${item.brand}`}
              class="max-h-full max-w-full object-contain"
              loading="lazy"
            />
          </div>

          {/* Texto CTA */}
          <div class="relative z-10 mt-auto text-center">
            <h3 class="mb-1 font-serif text-xl font-bold text-glam-navy">{item.brand}</h3>
            <span class="text-sm font-medium text-pink-500 decoration-2 underline-offset-4 group-hover:underline">
              Ver Revista →
            </span>
          </div>
        </a>
      ))
    }
  </div>

  <div class="mt-12 text-center">
    <Button href="/links" variant="outline" className="px-8"> Ver Todos los Catálogos </Button>
  </div>
</section>
