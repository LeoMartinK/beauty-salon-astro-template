---
// src/components/effects/SnowEffect.astro
import { siteData } from '../../data/siteData';

// Si el modo navidad está apagado, no renderizamos nada.
if (!siteData.christmasMode) return null;
---

<div
  id="snow-container"
  class="pointer-events-none fixed inset-0 z-[60] overflow-hidden"
  aria-hidden="true"
  transition:persist
>
</div>

<script>
  // Envolvemos la lógica para evitar colisiones globales
  (function initSnow() {
    const SNOWFLAKE_COUNT = 35;
    const container = document.getElementById('snow-container');

    if (!container) return;

    // ✅ AGREGADO: Verificación de seguridad
    // Si el contenedor ya tiene copos (porque viene de otra página gracias a transition:persist),
    // no hacemos nada. Así evitamos duplicar la nieve infinitamente.
    if (container.childElementCount > 0) return;

    for (let i = 0; i < SNOWFLAKE_COUNT; i++) {
      createSnowflake();
    }

    function createSnowflake() {
      if (!container) return;

      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');

      // Asignamos clases aleatorias para variar el color (Oro o Rosa)
      const type = Math.random() > 0.5 ? 'gold' : 'rose';
      snowflake.classList.add(type);

      // Tamaños un poco más grandes para que se noten
      const size = Math.random() * 6 + 4; // Entre 4px y 10px
      const initialOpacity = Math.random() * 0.5 + 0.4; // Más opacos (visibles)
      const duration = Math.random() * 15 + 10; // Caída lenta
      const delay = Math.random() * 5;
      const position = Math.random() * 100;

      snowflake.style.width = `${size}px`;
      snowflake.style.height = `${size}px`;
      snowflake.style.left = `${position}%`;
      snowflake.style.opacity = initialOpacity.toString();
      snowflake.style.animationDuration = `${duration}s`;
      snowflake.style.animationDelay = `-${delay}s`;

      container.appendChild(snowflake);
    }
  })();
</script>

<style is:global>
  .snowflake {
    position: absolute;
    top: -10px;
    border-radius: 50%;

    /* CLAVE: Sombra suave para que se note sobre fondo blanco */
    box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);

    /* Animación */
    animation-name: fall;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
  }

  /* TIPO 1: ORO (Visible en fondos oscuros y claros) */
  .snowflake.gold {
    background-color: #d4af37; /* Oro clásico */
  }

  /* TIPO 2: ROSE GOLD (Combina con la marca, visible en blanco) */
  .snowflake.rose {
    background-color: #be185d; /* Un rosa oscuro/fucsia elegante */
  }

  @keyframes fall {
    0% {
      transform: translateY(-10vh) rotate(0deg);
    }
    100% {
      /* Caen, se mueven al costado y rotan un poco */
      transform: translateY(110vh) translateX(25px) rotate(360deg);
    }
  }
</style>
