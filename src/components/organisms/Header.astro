---
// src/components/organisms/Header.astro
import { siteData } from 'src/data/siteData';

import Button from '../atoms/Button.astro';

const { navigation, info } = siteData;
const currentPath = Astro.url.pathname;
---

<header
  class="fixed top-0 z-50 h-20 w-full border-b border-pink-100 bg-[#fcf4ec] shadow-sm transition-all duration-300"
  id="main-header"
>
  <div class="container relative mx-auto flex h-full items-center justify-between px-6">
    <a href="/" class="group z-50 flex select-none flex-col items-center py-2 leading-none">
      <span
        class="font-serif text-2xl font-bold tracking-widest text-glam-navy transition-colors group-hover:text-pink-500 md:text-3xl"
      >{info.title.toUpperCase()}</span>
      <span
        class="mt-1.5 text-[0.6rem] font-medium uppercase tracking-[0.35em] text-glam-gray transition-colors group-hover:text-glam-navy md:text-[0.65rem]"
      >
        {info.subtitle}
      </span>
    </a>

    <nav class="hidden items-center gap-8 md:flex">
      {
        navigation.map((item) => (
          <a
            href={item.href}
            class:list={[
              'group relative text-sm font-semibold uppercase tracking-wider transition-colors',
              currentPath === item.href ? 'text-pink-500' : 'text-glam-gray hover:text-glam-navy',
            ]}
          >
            {item.label}
            <span
              class:list={[
                'absolute -bottom-1 left-0 h-0.5 w-0 bg-pink-400 transition-all duration-300 group-hover:w-full',
                currentPath === item.href ? 'w-full' : '',
              ]}
            />
          </a>
        ))
      }
      <Button href={info.whatsappLink} size="sm" variant="primary"> Reservar </Button>
    </nav>

    <button id="mobile-menu-btn" class="z-50 p-2 text-glam-navy focus:outline-none md:hidden">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-8 w-8"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16m-7 6h7"></path>
      </svg>
    </button>

    <div
      id="mobile-menu"
      class="fixed left-0 top-20 z-40 hidden h-[calc(100vh-5rem)] w-full flex-col items-center space-y-6 overflow-y-auto border-t border-pink-200 bg-[#fcf4ec] pb-20 pt-8 shadow-inner"
    >
      {
        navigation.map((item) => (
          <a
            href={item.href}
            class="mobile-link py-2 font-serif text-xl tracking-wider text-glam-navy hover:text-pink-500"
          >
            {item.label}
          </a>
        ))
      }

      <div class="pt-4">
        <Button href={info.whatsappLink} size="md" variant="primary"> Reservar Cita </Button>
      </div>

      <div class="mt-4 flex w-1/2 justify-center gap-6 border-t border-pink-100 pt-4">
        <a
          href={siteData.social.instagram}
          target="_blank"
          class="font-medium text-pink-400 hover:text-pink-600"
        >
          Instagram
        </a>
        <a
          href={siteData.social.facebook}
          target="_blank"
          class="font-medium text-pink-400 hover:text-pink-600"
        >
          Facebook
        </a>
      </div>

      <div class="h-10 shrink-0"></div>
    </div>
  </div>
</header>

<script>
  // Usamos 'astro:page-load' para reiniciar el menú en cada navegación
  document.addEventListener('astro:page-load', () => {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileLinks = document.querySelectorAll('.mobile-link'); // Seleccionamos los links

    // Función para cerrar menú (útil para reutilizar)
    const closeMenu = () => {
      mobileMenu?.classList.add('hidden');
      mobileMenu?.classList.remove('flex');
      document.body.classList.remove('overflow-hidden');
    };

    // 1. Toggle al hacer clic en el botón hamburguesa
    menuBtn?.addEventListener('click', (e) => {
      e.stopPropagation(); // Evitar que el clic se propague
      const isHidden = mobileMenu?.classList.contains('hidden');

      if (isHidden) {
        // Abrir
        mobileMenu?.classList.remove('hidden');
        mobileMenu?.classList.add('flex');
        document.body.classList.add('overflow-hidden');
      } else {
        // Cerrar
        closeMenu();
      }
    });

    // 2. Cerrar automáticamente al hacer clic en un enlace
    mobileLinks.forEach((link) => {
      link.addEventListener('click', () => {
        closeMenu();
      });
    });
  });
</script>
